<include file="Public:head"/> 
<link rel="stylesheet" type="text/css" href="/themes/a/css/shop.css" />
<link href="/themes/a/css/jquery.dataTables.css" rel="stylesheet" type="text/css">
<script src="/themes/a/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<script>
function upyunPicUpload(domid,width,height,token){
	art.dialog.data('width', width);
	art.dialog.data('height', height);
	art.dialog.data('domid', domid);
	art.dialog.data('lastpic', $('#'+domid).val());
	art.dialog.open('?g=User&m=Upyun&a=upload&token='+token+'&width='+width,{lock:true,title:'上传附件',width:600,height:400,yesText:'关闭',background: '#000',opacity: 0.45});
}
</script>
<style>
	a.a_upload, a.a_choose {
	    background-color: #f1f1f1;
	    background-image: -moz-linear-gradient(center bottom , #ccc 0%, #e5e5e5 3%, #fff 97%, #fff 100%);
	    border: 1px solid #aaa;
	    border-radius: 3px;
	    box-shadow: 0 1px #cccccc;
	    color: #000;
	    cursor: pointer;
	    display: inline-block;
	    font-size: 14px;
	    line-height: 1.5;
	    overflow: visible;
	    padding: 2px 8px;
	    text-align: center;
	    text-shadow: 0 1px #ffffff;
	    vertical-align: middle;
	}
	 .a_upload, .a_choose {
	    background-color: #44b549 !important;
	    background-image: none !important;
	    border: medium none !important;
	    border-radius: 2px !important;
	    color: #fff !important;
	    cursor: pointer !important;
	    display: inline-block !important;
	    font-size: 14px !important;
	    margin-left: 5px;
	    overflow: visible !important;
	    padding: 2px 8px !important;
	    text-shadow: none !important;
	}
</style>
<div class="content">
	  <div class="cLineB">
	    <h4 class="left">微信红包管理</h4>
	    <div class="clr"></div>
	  </div>
	  <!--tab start-->
	  <div class="tab">
		  <ul>
			  <li class="current tabli" id="tab0">微信基本参数设置</li>
			  <li class="tabli" id="tab1"><a href="{lingzh::U('RedCash/setting_list')}">微信红包设置</a></li>
			  <!--<li class="tabli" id="tab2"><a href="{lingzh::U('RedCash/cash_list')}">发送红包信息列表</a></li>-->
		  </ul>
	  </div>
	  <!--tab end-->
	<div class="cLineB">
 	</div>
	<div class="msgWrap bgfc">
	  <form id="wxconf_form" class="form" method="post">  
        <input type="hidden" name="wxconf_id"  value="{lingzh:$conf['id']}"></input>
	    <table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%">
	      <tbody>
	        <tr>
	          <th><span class="red">*</span>公众号身份标识[AppID]：</th>
	          <td>
	            <input style="width:400px;" name="appid" class="text textMiddle" value="{lingzh:$conf['appid']}"></input>
	          </td>
	        </tr>
	        <tr>
	         <th><span class="red">*</span>API密钥[Key]：</th>
	          <td>
	            <input style="width:400px;" name="key" class="text textMiddle" value="{lingzh:$conf['key']}"></input>
	          </td>
	        </tr>
	        <tr>
	         <th><span class="red">*</span>商户号[Mch_id]：</th>
	          <td>
	            <input style="width:400px;" name="mchid" class="text textMiddle" value="{lingzh:$conf['mchid']}"></input>
	          </td>
	        </tr>
	       <tr>
	         <th><span class="red">*</span>证书[apiclient_cert.pem]：</th>
	          <td>
	            <input style="width:400px;" id="ssl_cert" name="ssl_cert" class="text textMiddle" value="{lingzh:$conf['ssl_cert']}"></input>
            	 <a href="###" onclick="upyunPicUpload('ssl_cert',0, 0,'{lingzh:$token}')" class="a_upload">上传</a>
	          </td>
	        </tr>
	        <tr>
	         <th><span class="red">*</span>证书密钥[apiclient_key.pem]：</th>
	          <td>
	            <input style="width:400px;" id="ssl_key" name="ssl_key" class="text textMiddle" value="{lingzh:$conf['ssl_key']}"></input>
            	 <a href="###" onclick="upyunPicUpload('ssl_key',0, 0,'{lingzh:$token}')" class="a_upload">上传</a>
	          </td>
	        </tr>
	        <tr>
	         <th><span class="red">*</span>CA证书[rootca.pem]：</th>
	          <td>
	            <input style="width:400px;" id="ssl_cainfo" name="ssl_cainfo" class="text textMiddle" value="{lingzh:$conf['ssl_cainfo']}"></input>
            	 <a href="###" onclick="upyunPicUpload('ssl_cainfo', 0, 0, '{lingzh:$token}')" class="a_upload">上传</a>
	          </td>
	        </tr>
	        <tr>
	          <th>&nbsp;</th>
	          <td>
	            <button type="submit" name="button" class="btnGreen">保存</button>
	          </td>
	        </tr>
	      </tbody>
	    </table>
	  </form>
  </div> 
</div>
<link rel="stylesheet" href="/js/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="/js//kindeditor/plugins/code/prettify.css" />
<script src="/js/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="/js/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script>
	jQuery.validator.addMethod("accept", function(value, element, params) { 
		params = typeof params == "string" ? params : "png|jpe?g|gif";
		return this.optional(element) || value.match(new RegExp(".(" + params + ")$", "i")); 
	}, "请输入pem格式文件"); 

	$("#wxconf_form").validate({
	    rules: {
	    	appid : {
				required : true
			},
			key : {
				required : true
			},
			mchid : {
				required : true
			},
			ssl_cert : {
				required : true,
				accept : 'pem'
			},
			ssl_key : {
				required : true
			},
			ssl_cainfo : {
				required : true
			}
	    },
	    messages :{
	    	appid : {
				required : "请输入公众号身份标识"
	    	},
			key : {
				required : "请输入API密钥"
			},
			mchid : {
				required : "请输入商户号"
			},
			ssl_cert : {
				required : "请输入证书",
				accept: "文件格式不支持，请上传pem格式的文件"  
			},
			ssl_key : {
				required : "请输入证书密钥",
				accept: "文件格式不支持，请上传pem格式的文件"  
			},
			ssl_cainfo : {
				required : "请输入CA证书",
				accept: "文件格式不支持，请上传pem格式的文件"  
			}
	    },
		errorPlacement: function (error, element) {
			error.insertAfter(element); 
		},
		submitHandler : function(form){ 
			$("#wxconf_form").submit();
		}
	});
</script>
<include file="Public:footer"/>
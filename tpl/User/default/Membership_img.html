<include file="Public:head"/>
<link rel="stylesheet" type="text/css" href="/themes/a/css/shop.css" />
<link rel="stylesheet" href="/themes/a/css/img_upload_panel.css" />
<link rel="stylesheet" type="text/css" href="/js/uploadify/uploadify.css">
<script src="/js/uploadify/jquery.uploadify.min.js?v=<?php echo rand(0,99999);?>" type="text/javascript"></script>
<style type="text/css">
.clr{
clear:both;
}
.chatPanel .mediaFullText .mediaContent {
font-size: 14px;}
.chatPanel .media {
border:0px solid #D1D1D1;
box-shadow:0 0px 5px 0 rgba(0, 0, 0, 0.25);
-moz-box-shadow:0 0px 5px 0 rgba(0, 0, 0, 0.25);
-webkit-box-shadow:0 0px 5px 0 rgba(0, 0, 0, 0.25);
-webkit-border-radius:5px 5px 10px 10px;
-moz-border-radius:5px 5px 10px 10px;
border-radius:5px 5px 10px 10px;
background: url({lingzh::RES}/images/photo/bottom.png) repeat-x scroll left bottom #FFFFFF;
background-size:2px auto;
}
.chatPanel .media .mediaHead .title {
line-height:1.2em;
font-size:16px;
display:block;
text-align: left;
margin-top:0;
padding:0;
height: auto;
}
.chatPanel .media .mediaPanel {
padding:0px;
margin:0px;
}
.chatPanel .media .mediaHead {
padding: 10px 10px 8px;
border-bottom: 0px solid #D3D8DC;
color: #000000;
font-size: 20px;
}

.chatPanel .media .mediaFooter {
padding: 0 10px;
}
.chatPanel .mediaFullText .mediaImg {
width: 265px;
margin: 0 10px;}
.chatPanel .mediaFullText .mediaImg img{  width: 100%; height:150px;}
.chatPanel .mediaFullText .mediaContentP {
margin: 5px 10px 0px;
}
.chatPanel .mediaFullText .mediaContentP p{
line-height:18px
}
.chatPanel .mediaFullText .mediaContent {
padding: 0 0 5px;
}
</style>

<script type="text/javascript">
function syncPreviewText(fromId, toId) {    
  document.getElementById(toId).innerHTML=document.getElementById(fromId).value;
}

function syncPreviewImg(fromId, toId) {    
  document.getElementById(toId).src=document.getElementById(fromId).value;
}
</script>

<div class="content">
  <div class="cLineB"> 
    <div class="clr"></div>
  </div> 
  <!--tab start-->
  <div class="tab">
  <ul>
    <li class="current tabli" id="tab0"><a href="{lingzh::U('Membership/img')}">会员卡图文消息</a></li>
    <li class="tabli" id="tab3"><a href="{lingzh::U('Member_card/info')}">商家信息设置</a></li>
    <li class="tabli" id="tab1"><a href="{lingzh::U('Member_card/index')}">卡片设计</a></li>
    <li class="tabli" id="tab4"><a href="{lingzh::U('Member/setmemberinfo')}">会员资料设置</a></li>
    <li class="tabli" id="tab5"><a href="{lingzh::U('Member/setclassinfo')}">自定义会员等级</a></li>
    <li class="tabli" id="tab6"><a href="{lingzh::U('Member_card/exchange')}">积分规则设置</a></li>
  </ul>
  </div>
  <!--tab end--> 
  <div class="cLineB"> 
  </div>
         
  <div class="msgWrap bgfc">
	  <form class="form" method="post" action="{lingzh::U('Membership/img')}" enctype="multipart/form-data">	 
		<table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%">
			<tbody>
				<tr>
				  <th valign="top">说明：</th>
				  <td><span class="red">当用户发送“会员卡”到公众号时，系统将回复此图文消息。</span></td>
			    <td width="300px" rowspan="5" valign="top" class="chatPanel" style="padding:0px;" align="left">
            <div class="chatItem you" id="photo1"> 
　              <a target="ddd" href="">
                <div class="media mediaFullText">
                  <div class="mediaPanel">
                    <div class="mediaHead"><span class="title" id="zname">{lingzh:$membership.title}</span></div>
                    <div class="mediaImg"><img id="zpic" style="width: 280px" src="{lingzh:$membership.pic}"></div>
                    <div class="mediaContent mediaContentP" style="width: 280px">
                      <pre id="zinfo" style="width: 280px;word-wrap: break-word;">{lingzh:$membership.text}</pre>
                    </div>
                    <div class="mediaFooter">
                      <span class="mesgIcon right"></span><span style="line-height:50px;" class="left">查看全文</span>
                      <div class="clr"></div>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </td>
				</tr>
				<tr>
					<th width="120"><span class="red">*</span>标题：</th>
					<td><input type="text" id="title" name="title" value="{lingzh:$membership.title}" class="px" style="width:400px;" onkeyup="syncPreviewText('title', 'zname')"></td>
				</tr>
        <tr>
					<th valign="top"><span class="red">*</span>封面图片地址：</th>
					<td><input id="pic_url_input" type="text" name="pic" value="{lingzh:$membership.pic}" class="px" style="width:400px;" onblur="syncPreviewImg('pic_url_input','zpic')">
            <div class='img_upload_panel'>
               <div name='uploadify'  id="uploadify_msh"  ></div>                                                  
               <div id="fileQueue_msh"></div> 
                <div style="clr:both; height:0px;"></div>
             </div>
          </td>
				</tr>
				<tr>
					<th width="120">内容摘要（可不填）：</th>
					<td>
            <textarea style="width:400px;height:75px" name="text" id="info" class="px" onkeyup="syncPreviewText('info', 'zinfo')">{lingzh:$membership.text}</textarea>
            <br/>最多填写120个字
          </td>
				</tr>
        <tr>
          <th>&nbsp;</th>
          <td>
            <button type="submit" name="button" class="btnGreen">保存</button>
            <a href="javascript:history.go(-1);" class="btnGray vm">取消</a>
          </td>
        </tr>
			</tbody>
		</table>
	</form>
  </div> 
</div>
<script>
 $(function() {
    $(uploadify_msh).uploadify({
       'buttonText' : '选择封面',
        'fileTypeDesc' : 'Image Files',
        'fileTypeExts' : '*.gif; *.jpg; *.jpeg; *.png',
        'fileSizeLimit' : '1MB',
        'swf'      : '/js/uploadify/uploadify.swf', //进度条，Uploadify里面含有 
         'uploader': '/index.php/upload/image', //如果没有相册/3d的概念可以把这两个参数忽略
         'cancelImg': '/js/uploadify/uploadify-cancel.png', //取消图片路径 
         'onFallback': function() {
             alert('您的浏览器没有安装Flash插件');
         },
         //'folder': 'uploadFile', //上传文件夹名 
         'queueID': 'fileQueue_msh',
         'auto': true,
         'onUploadSuccess' :  function(file, data, response) {
            if (response == true) {
                var res_json = eval("("+data+")");
                if (res_json.error == 0 ) {
                    document.getElementById('zpic').src=  res_json.content ;
                    //$('#picUrl_fla').val(res_json.content);
                    $('#pic_url_input').val(res_json.content);
                } else {
                    alert(res_json.message);
                }

            } else {
               alert("网络不给力啊！亲");
            }

         },
         formData : { '<?php echo 'param1';?>' : '<?php echo base64_encode(session_id());?>' }, <?php  //using session for 302 error of uploadify ?>
         //'uploadLimit' : 1,
         'multi': false,
     });
     $("#uploadify_msh").css('width', '100%');
     $("#uploadify_msh").append('<span class="img_upload_tips">支持JPG、PNG、GIF等格式，大小不超过1MB。<br/>也可将图片上传到POCO.cn等网站获取图片链接地址填入</span>');

});  
</script>
<include file="Public:footer"/>